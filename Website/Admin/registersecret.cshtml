@{
    var db = Database.Open("Membership");
    var Users = db.Query("SELECT email FROM UserProfile");


    string[] array = new string[1] {"administrator"};
    WebSecurity.RequireRoles(array);

    var username = "";
    var password = "";
    var confirmPassword = "";
    var errorMessage = "";
    var succesmessage = "";

    var username2 = "";
    var password2 = "";
    var confirmPassword2 = "";
    var errorMessage2 = "";
    var resetToken = "";
    var succesmessage2 = "";

    if (IsPost)
    {
        username = Request["username"];
        password = Request["password"];
        confirmPassword = Request["confirmPassword"];

        username2 = Request["username2"];
        password2 = Request["password2"];
        confirmPassword2 = Request["confirmPassword2"];

        if (!(username == null) && !(password == null) && !(confirmPassword == null))
        {
            if (password != confirmPassword)
            {
                errorMessage = "Wachtwoorden komen niet overeen.";
            }

            else
            {
                if (WebSecurity.UserExists(username))
                {
                    errorMessage = String.Format("De gebruiker '{0}' bestaat al.", username);
                }

                else
                {
                    WebSecurity.CreateUserAndAccount(username, password, null, false);
                    succesmessage = String.Format("{0} aangemaakt.", username);
                }
            }
        }

        else if (!(username2 == null) && !(password2 == null) && !(confirmPassword2 == null) && !(username2 == "") && !(password2 == "") && !(confirmPassword2 == ""))
        {
            if (password2 != confirmPassword2)
            {
                errorMessage2 = "Wachtwoorden komen niet overeen.";
            }

            else
            {
                resetToken = WebSecurity.GeneratePasswordResetToken(username2, 5);
                WebSecurity.ResetPassword(resetToken, password2);
                succesmessage2 = String.Format("Wachtwoord aangepast voor: " + username2);
            }
        }
    }
}

<!DOCTYPE html>
<html>
<head>
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="~/css/materialize.min.css" media="screen,projection" />
    <link type="text/css" rel="stylesheet" href="~/css/stylesheet.css" media="screen,projection" />

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Menger | Admin</title>
    <link rel="shortcut icon" href="~/img/Menger-Favicon.png" title="Favicon">
</head>

<body class="grey lighten-2">
    <!-- Navbar -->
    <nav class="nav-center">
        <div class="nav-wrapper grey darken-4">

            <!-- logo -->
            <a href="~/Admin/registersecret">
                <img class="col l1 offset-l10 m8 offset-m2 s12 brand-logo" src="~/img/logo.png" />
            </a>

            <!-- Mobile responsive menu -->
            <a href="#" data-activates="mobile-demo" class="button-collapse"><i class="material-icons">menu</i></a>

            <!-- Dropdown -->
            <ul id='dropdown' class='dropdown-content'>
                <li><a href="~/Admin/logout" style="font-size: 14px; padding: 12px 26px">Uitloggen<i class="tiny material-icons">power_settings_new</i></a></li>
            </ul>

            <ul class="hide-on-med-and-down">
                <li><a class='dropdown-button right' data-beloworigin="true" href='#' data-activates='dropdown'><i class="material-icons">more_vert</i></a></li>
                <li><a style="font-size: small;" class="right">Hallo, @WebSecurity.CurrentUserName !</a></li>
            </ul>
            <ul class="side-nav" *id="mobile-demo">
                <li><a href="~/Admin/logout" style="font-size: 14px"><i class="tiny material-icons">power_settings_new</i>Uitloggen</a></li>
            </ul>
        </div>
    </nav>


    <div class="row">
        <div class="col s12 m6 l3">
            <div class="card-panel grey darken-4">
                <div class="card-content ">
                    <div class="row white-text">
                        <form class="col s12" method="post">
                            <span style="font-size: 16px;" class="card-title">Gebruiker aanmaken</span>
                            <p>
                                @if (errorMessage != "")
                                {
                                    <span class="errorMessage">@Html.Raw(errorMessage)</span>
                                }
                            </p>

                            <div class="input-field col s12">
                                <input type="text" name="username" value="@Request.Form["username"]">
                                <label for="username">Gebruikersnaam</label>
                            </div>

                            <div class="input-field col s12">
                                <input type="password" name="password" value="@Request.Form["password"]">
                                <label for="password">Wachtwoord</label>
                            </div>

                            <div class="input-field col s12">
                                <input type="password" name="confirmPassword" value="@Request.Form["confirmPassword"]">
                                <label for="confirmPassword">Bevestig Wachtwoord</label>
                                <a class="succesText">@succesmessage</a>
                            </div>
                            <button class="btn right taximengeryellow" runat="server" type="submit" name="action" id="form1">Bevestig</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="col s12 m6 l3">
            <div class="card-panel grey darken-4">
                <div class="card-content ">
                    <div class="row white-text">
                        <form class="col s12" method="post">
                            <span style="font-size: 16px;" class="card-title">Wachtwoord aanpassen</span>
                            <p>
                                @if (errorMessage2 != "")
                                {
                                    <span class="errorMessage">@Html.Raw(errorMessage2)</span>
                                }
                            </p>

                            <div class="input-field col s12">
                                <select name="username2" value="@Request.Form["username2"]">
                                    <option value="@Request.Form["username2"]" class="disabled" selected>Selecteer een gebruiker</option>
                                    @foreach (var user in Users)
                                    {
                                        <option type="text" name="username2" class="black-text" value ="@Request.Form["username2"]">@user.email</option>
                                    }
                                </select>
                                <label for="username2">Gebruiker</label>
                            </div>

                            <div class="input-field col s12">
                                <input type="password" name="password2" value="@Request.Form["password2"]">
                                <label for="password2">Wachtwoord</label>
                            </div>

                            <div class="input-field col s12">
                                <input type="password" name="confirmPassword2" value="@Request.Form["confirmPassword2"]">
                                <label for="confirmPassword2">Bevestig Wachtwoord</label>
                                <a class="succesText">@succesmessage2</a>
                            </div>

                            <button class="btn right taximengeryellow" runat="server" type="submit" name="action" id="form2">Bevestig</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!--Import jQuery before materialize.js-->
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="~/js/materialize.min.js"></script>
    <script>
        $(".button-collapse").sideNav();

        $('select').material_select();

    </script>

</body>
</html>
